# 阅读源码前必须搞懂的几件事 -- 以一个对 VSCode 发起的 PR 为例
# 也许你不应该读源码

## 为什么不要读源码

如果问我到底要不要读源码，我的回答一定是 **不要**。
这不是因为读源码一无是处，而是因为，如果一个人问的是“要不要读源码”而非“如何读源码”，说明他自己都不清楚读源码有什么价值，他的动机更多是一种人云亦云。
在这种情况下，直接去读源码其实是很危险的。因为一个也许超乎人大多数意料的事实是，读源码甚至可以说是一种低效的项目学习行为。
代码，本质上是项目开发者思考后得出的结论，而不是其思考的过程。只看代码而不了解开发的思考过程，就如同不看教科书就直接开始做数学题。哪怕背下来当前问题的答案，只要稍稍变换一下问题的表达方式，就会让人再次陷入迷茫。

在阅读源码的过程中，会有很多新人可能没有意识到的坑，稍有不慎就会被这些问题折磨得头大，而且让阅读源码的行为一无所获。结合过去几年大量阅读开源项目的经历，我认为在真正开始读源码之前，需要搞清楚这几个问题：
1. 为什么大家都在读源码?
2. 什么时候该读源码？
3. 选择的项目能读懂吗？
4. 具体如何读源码？

同时，为了让大家更好掌握阅读、理解源码的完整流程，我还会在最后展示一个对 VSCode 发起的真实 Pull Request 案例。

希望能通过这种理论加实践的方式，帮大家对源码阅读的原则和技巧都有更深刻的理解。

## 为什么大家都在读源码

首先要搞清一点：既然读源码有这样的问题，为什么还是有很多人推崇它呢？
因为，虽然理论上有各种更好的编程学习方法，但这些方法的成本太高，以至于对普通人而言不切实际。大佬们没理由手把手教我们这些“小白”。我也知道 Linus 肯定是最懂操作系统的人，但我现在能把他叫过来，给我讲讲操作系统怎么设计吗？显然不现实。
所以，去读那些经典的代码，用这种接近逆向工程的方式，揣摩他们的设计理念，可能是在我们所有可行选择中相对较好的一种方案了。虽然这个过程往往比较痛苦，但也可能是研发成长的必经之路。
但我们一定也要认识到，读源码是最后的手段。只要有其他的方式能解决目的，就不要轻易尝试读源码这种出力不讨好的手段。

## 什么时候该读源码？

那什么情况下，我们该阅读源码呢？
不妨先拆解一下软件项目的类型，通常来说有以下两类：
第一类是学术性的项目；
第二类是应用型的项目。

### 学术性的项目

学术性的项目，更像是我们在计算机科学课程中学到的那些基础知识，比如数据结构、操作系统之类。
对于这类项目，我是极不推荐大家直接去阅读源码的。因为我们有大量教科书或研究论文作为资料，这些自然语言写成的内容，通常来说要比源码好理解得多。因为它反映的是人的思考路径，而并非思考结论。而且，好的学习资料通常也会附带大量代码，结合文章理解代码的设计理念，显然比我们闷头研究一个完全未知的项目体验要好得多。

### 应用型的项目

而对于应用型项目来说，它又可以分为两种子类型。
第一种是框架工具，比如 Django、Spring 这样的 Web 框架，或者 Lodash、Numpy 这样的工具库；
第二种是完整的产品应用，比如 VS Code 或者 Windows Terminal。
学习这两种类型项目的手段也是完全不同的。

首先说框架类的项目。
如果你的目的只是想学会如何使用，而非开发一个框架的话，那我其实也并不是很推荐大家去阅读框架的源码：如果一个框架需要使用者阅读源码才能高效使用的话，那说明它的抽象设计或者文档是有问题的。这时可能更好的策略是不要选择这个框架。
如果是为了应付面试，那坦白说，多看看面试题的效果要比看代码强。因为大多数面试官也不会很认真地去看项目源码，大家也无非是网上抄一些面经的题互相看看。说不定你老老实实看代码得出的结论，和网上的标准答案不一样，面试官还因此挂你呢。

而如果要学习那些产品应用的项目代码，首先要确定的是这些仓库本身的质量。
产品的成功和架构设计的成功是两回事，并不是说一个项目名气大就一定代码质量好。如果我们学习了一个可能代码风格并不太好的项目，反而影响了自己的代码质量，那实在是太可惜了。
想分析仓库质量，首先要看项目最近的更新频率。随着人们对软件工程领域的不断探索，项目的最佳开发实践也是在不断变化的。尤其是在应用开发的领域，时间相隔三五年，同一功能的写法可能完全不一样。如果一个项目过于老旧，那我们就得对它的代码质量打个问号。
另外，也要看项目中文档的质量。项目中文档详实，一方面反映了，项目开发者对此项目的重视；另外，其也能作为我们开发时的参考资料，降低阅读时的理解成本。

## 选择的项目能读懂吗？

在此之后，我们还需要务实地选择一些符合我们能力范围的仓库来阅读。
举个例子，一个新人刚学会 JS 的语法，这时直接给他搬出 VS Code 源码，让他几天后阐述 VS Code 的架构设计，那显然他会一脸懵逼、不知所措。
这就如同游戏里越级打 Boss，攻击都不破防，怎么能打败 Boss 呢？游戏中有明确的等级要求，但现实的项目中却大多不会把人们阅读项目所需要的能力前提罗列出来。在真的决定读源码之前，我们还需要做一些基础的判断，让自己对这个项目的难度有大概的预估，不要想着一口气吃成个胖子。

此外，在我们新了解一个项目的时，最好不要设立一个太过宏大的目标，比如看懂项目架构设计之类。在没有通过一些简单的功能修改，验证自己的思路是否正确之前，贸然尝试对项目架构进行解读是危险的。因为我们并没有一个反馈机制验证自己的想法是对是错，一旦误入歧途，很可能会许久也无法纠正过来。

一个更好的手段是从一些简单的功能修改入手，完成一次对项目的 Pull Request，由维护者完成 Code Review，进而验证我们的理解是否正确。
想要再简单一点的话，不妨寻找那些社区中有一定讨论，甚至已经存在 PR 合并的功能。通过了解社区的讨论，以及 PR 中具体的 Code Review，来获取当前需求下较为完整的上下文。在此之后，结合自己的认识，分析功能是否还拥有可以优化的补充能力，以此作为我们第一次对项目的功能修改。这样的方法既保证了自己的参与度，同时也让我们对项目的上手难度降到了最低。

## 如何读源码？

经过分析并确定了要阅读的仓库项目和目标后，我们终于可以开始阅读源码了。

首先，我们需要找到合适的切入点来分析项目。复杂项目通常不是按顺序执行的脚本逻辑，其拥有大量的切面。我们很难通过顺序阅读代码理解整个项目。此时快速定位逻辑实现位置的能力至关重要。
对于后端项目来说，因为我们通常要修改的都是某个 API 的实现，所有一个直观的方法是从路由层入手，查看哪个 Controller 实现了对应的 API。如果没有思路，甚至可以在项目中直接字符串搜索，找到与 API 名称相关的内容，以此作为切入点。
而对于前端项目，我们可以通过 F12 打开控制台，查看想要修改的元素及其对应的类名。以此为基础，找到对应的 UI 功能。
当然，如果我们能够找到一个相关的社区 PR，就可以省去这些定位流程，直接确定相关功能的实现文件。这也是为什么上文中我们强调要紧跟社区 PR 的原因。

然后则是最重要的一步，将项目运行起来。
只有运行后，我们才能使用断点调试功能，或者验证修改代码后功能变更的结果，进而验证我们对项目的理解是否正确。如果只是看代码的话，即使对项目的理解出现了错误，我们也难以察觉。
在这个阶段，我们不必过度关注最终效果是否符合预期，重点应放在培养对项目运行逻辑的直觉：
面对那些庞大的项目，我们无法逐行理解其逻辑。因此，通过这种类似“黑盒”调试的方法，能让我们对项目功能的执行流程有一个大致的估计，进而确定具体的代码修改方案。

接下来的具体开发策略则会因人、因项目而异，因此我也很难给出非常通用的方法建议。此外，很多技术大佬在 B 站、知乎或其他平台上已经介绍了很多具体的思路，秉持“不要重复造轮子”的精神，我就不再详细介绍了。希望大家自己在经历这一部分流程时，多思考、多总结，如此才可能有持续的成长。

以上就是我个人阅读源码的思路总结，希望能对大家有所帮助。
祝大家在源码阅读的路上都能有所收获！