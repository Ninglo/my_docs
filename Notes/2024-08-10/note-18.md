# 也许你不应该读源码

## 为什么不要读源码

任何人问我要不要读源码，我都一定会回答 **不要**。
这不是因为读源码一无是处；而是因为，如果一个人问的是 “要不要读源码” 而非 “如何读源码”，说明他自己都不清楚读源码有什么价值，他的动机更多是一种人云亦云。
在这种情况下，直接去读源码其实是很危险的。因为一个也许超乎人大多数意料的事实是，读源码甚至可以说是一种低效的项目学习行为：
代码，本质上是项目开发者思考后得出的结论，而不是其思考的过程。只看代码而不了解开发的思考过程，就如同不看教科书就直接开始做数学题。哪怕背下来当前问题的答案，只要稍稍变换一下问题的表达方式就又会没有思路。

在阅读源码的过程中 ，其实有很多。 新人可能没有意识到的坑。 稍有不慎就会被这些 问题折磨得头大 而且最终一无所获 结合过去几年，我的经验 我总结了几个 常见的问题，并在最后 一个 真实的 对v s code发 pull request。 维利。 像大家介绍一些阅读源码时的。 丝路与及执行过程。 希望 能对大家 掌握阅读源码这件事情有所帮助

<!-- 并会在最后通过一个对 VSCode 发起的真实 Pull Request 来 -->

## 为什么大家都在读源码

可既然读源码有这样的问题，为什么还是有很多人推崇它呢？
因为，虽然理论上有各种更好的编程学习的方法，但这些方法的成本太高，以至于对普通人而言不切实际。我也知道 Linus 肯定是最懂操作系统的人，可我现在能把他叫过来，给我讲讲操作系统怎么设计吗？显然也不现实。
所以，去读那些经典的代码，用这种接近逆向工程的方式，揣摩他们的设计理念。可能是在我们所有可行选择中相对较好的一种方案了。虽然这个过程往往比较痛苦，但也可能是研发成长的必经之路。
<!-- 换句话说，当我们真的做出读源码这个行动的时候，一定要有明确的、其他手段都无法解决的目的。
这个目的要足够的精确，而不能只是一个口号。它不是别人宣贯出来的一个理念，不能只是 “某某项目听起来很厉害，我要读看它的源码” 这样的口号。目的需要可衡量的结果，需要有切实解决的目的。 -->
但我们一定要认识到，读源码是最后的手段。只要有其他的方式能解决目的，就不要轻易的尝试读源码这种出力不讨好的手段。 


## 读源码的目的有哪些
<!-- 真的非要读源码不可吗？ -->

我们不妨先拆解一下软件项目的类型，通常来说有两类：
第一类是学术性的项目； // 名字可以改下
第二类是应用型的项目。 

学术性的项目，更像是我们在计算机科学课程中学到的那些基础知识，比如数据结构、操作系统之类。
这里项目我是极不推荐直接去阅读源码的。因为我们有大量教科书或是研究论文作为资料，这些自然语言写成的内容，通常来说要比源码好理解的多。因为它反映的是人的思考路径，而并非是思考结论。而且好的学习资料通常也会附带大量的源码，结合文章理解项目代码，显然比我们闷头看一个完全未知的项目体验要好的多。

而对于应用型的项目来说，其又可以分为两种子类型。
第一种是框架工具类，比如 django、spring 这样的 Web 框架，或者 lodash、numpy 这样的工具库；
第二种是一个完整的产品 application，比如 VSCode 或者 Windows terminal。
学习这两种类型项目的手段也是完全不同的。

首先说框架性的一定项目。
如果你只是 想应用。 而非 开发一个框架的话。那其实并不是非常推荐去阅读框架的源码 因为如果一个框架需要使用者阅读源码才能高效使用的话，其实说明它的抽象设计或者文档是有问题的 这是一个不太好的项目 可能更好的策略是不要选 
如果是要应付面试的话 那坦白说 多看看8股的效果 要比真老是看代码强 这其实是一个过拟合的问题 大多数面试官也不会很认真的去看那些内容 大家也就是网上抄一些面经的题 互相看看 说不定你老老实实 看代码得出的结论和网上的八股答案不一样面试官还因此挂你呢 不如直接上网背答案

如果是一些工程上的编程能力练习
首先要确定的是 这些仓库本身质量一定要好 不能天天学点坏东西
产品的成功和 架构设计的成功是两回事情，并不是说一个项目名气大就一定代码质量好了，那如果我们学习了一个可能代码风格并不太好的项目。 反而学坏了 走火入魔那实在是不必要了
需要分析仓库自己的质量 还有项目仓库自己的更新频率
先看最近更新频率 通常 尤其是一些网红语 如果时间早个三五年，可能写法完全不一样，甚至落后的 另外，中间的一些依赖可能也不再维护我们运行的运行不起来就显然是有很大影响
首先最明显的就是大数先要看star的数量 另外一个关键因素是 是否是大厂还是个人项目 通常大厂的项目有基础的文档。更加
另外也要看文档的质量 如果项目都没有什么。Read me 那我们也很难把项目启动起来

## 我们的水平支持吗？
<!-- 如何让这个过程更简单 -->

在此之后，我们还需要务实的选择一些符合我们能力范围仓库区阅读。举个例子比如一个新人可能刚学会了 js 的语法 这时候你给他搬出来 vscode 源码让他来看，让他花几天看明白。 v s code 是如何 做性能优化 以及架构设计的  sn那显然，他一脸懵逼哪怕琢磨个半年可能都 sn不知道什么所以然这就是前置知识相差太多。 导致的低效率。 在游戏里这就相当于越级去打boss 连一些必要的技能或者等级都不达到那怎么可能 通关关卡呢？ 可游戏中有明确的等级要求 ，但现实中。 却不会给你在项目中，罗列出来想要读明白，他要求是什么？ 所以在我们真的确实做读源码这个行动之前我们还需要做一些基础的判断，让自己对这个项目的难度有大概的预估

然后还是结合，我们上文中已经确定的目的。 来分析，这个目标的可行性 嗯想要实现这个目的。 我们的拥有什么潜质的能力。而这些sn能力。我们是否都具备 还是说，sn 能力 差距太大不太适合在眼下完成这个目标 
sn举个例子比如我想要去 通过阅读源码学习一门与新的语言 的具体工程实践那我就要看我现在到底掌握了 这门语言的多少语法。 而这个项目中 是否用到了一些 非常复杂而我不了解的语法 嗯这个具体的项目。 涉及的产品形态，我是否足够了解，比如如果以前我已经有了sn比较丰富的后端开发经验，那哪怕我换一门语言去看他们的 web框架也大概率是熟悉的但一个。 通常的。 应用开发工程师直接去看一些底层****作系统 的代码。 甚至是与硬件相交互的那一部分逻辑。 嵌入式的功能 ，那显然 要求就更多难度更大 


此外的话，也看我们本身的需求 如果我们是 简单的改动一些 表层的功能 那他的项目虽然也许还是很复杂，但我们并不需要了解，这么大的复杂度可能呃理解一个局部子集就可以那分难度就可以稍微降低，但如果我们的目标是掌握这个项目完整的设计原理 那哪怕是一个简单的项目 也并不是看起来那么容易

所以对于一些没有太大，经验 坦白说问出这个问题的人就不太可能有很多经验不然他也不会去问别人自己就有数 那对于这一部分朋友来说，可能我们就采取简单的项目入手，更为务实一些
最终是一些具体的手段 原则是从简单的项目、以及简单的功能修改入手 在没有 通过一些简单的功能修改 验证自己的思路是否正确之前 贸然尝试呃对项目架构进行解读是 危险的因 你并没有一个反馈的机制，没有人告诉你的想法是对是错那可能误入歧途很久。 也没有掰回来 从一些小的功能修改出发，完成1次 pull request 由项目维护者 完成code review 从而 验证 我们的理解是否正确 可能是一个 好的方式。  这样至少我们可以读整个项目来保证对源码的理解 大项目困难之处在于，没法儿一下儿完整理解整个项目 只能基于自己的猜测 完成大块儿的内容的定义 然后去实现一些局部的部分 相当于很多逻辑是我们脑补的 而不是真实存在的 猜测正确与否 就很依赖我们的经验了 当然一方面如果有一些文档或者是文章的说明也很适合我们先补充一些大概的思路 在此之后 在切入项目中 才是更好的策略

然后就是找到一些词的功能 开始修修改改 比如我们改Vs code 结合自己的需求 我们的诉求是想要提升
一个很好的切入手段是发现需求 最好是那些社区已经完成修复 有一秀讨论以及PR合并的内容 因为这些内容一般相对简单 社区的贡献还是处于表层的位置，就降低了我们理解的难度 另外 整体的讨论流程也非常丰富 能帮助我们快速理解上下文 很多时候 这些大厂的工作流并不完全在给他 他们的信息差 会让我们理解内容很困难 还有一个额外的小优势是 社区的代码未必会考虑完整的case 他们都是解决自己的问题 那我们沿着他的思考路径来看 就容易发现一些额外的小问题来辅助修正 成本很低 但是也确实解决问题

然后 但同时，其实社区的PR也是一种follow的机会 因为受限于他们的理解不足 实现功能不一定非常完善 这就让我们在后续的小修小补中提供了机会

然后还有一个方案是如果我们想要解决的是一些具体的产品功能 想要完成1些新的产品功能，那我们不妨搜索一下 项目讨论区有没有相关的上下文比如有没有提出的issue然后有没有维护者的参与 来介绍 这个项目或者说，这个功能本身的复杂度在哪里 此外，如果有一些功能 嗯已经被提了m r或者相似的功能提了 m r。 pr 那我们完全可以通过这些呃pro request 来。 pull request。 作为切入点来学习相关的功能分析，他们的实现逻辑这样也能对让我们找到一个学习项目的入口不至于从命函数开始从头到尾把项目看一遍。 在这些sn前置如此之多的准备之后 ，我们或许才真正应该去sn进入到这个项目里边分析，它的源码
当然，在此之前，最好还是拿额外的信息，比如看一些相关的PR或者医学 如果我们有意 那首先发现一些我们想要改进的功能 然后去搜一下社区有没有相关的实现和讨论 其实最好的反而是那些已经被实现的能力 因为讨论过程更完整 而且有一个实现的结论 我们在最早入门的时候不太需要对项目有个太具体的把握，也能通过这个MR验证跟自己的差别 确认自己的思路正确
但同时其实社区的这些代码多有不足，所以我们很容易的思路能做一些小球修改

在有了这些目标后 我们才应该去研究如何去呀

几个判断的方法


## 如何读源码？

在如此这般分析，终于定下了我们。 我们的。 要阅读的仓库项目以及想要达成的目标之后 ，我们现在才应该真正涉及一些 具体如何阅读源码的分析

然后最重要的就是把项目运行 在运行后才应该调试 相当于验证我们的模型是否正确
再之后就是运行起来 项目 单看源码跟运行项目有什么区别呢 一个关键的点就是他为你通过改造代码验证想法产生的机会 我们首先要能打上断点或者调试功能，才能验证自己对代码的理解，不然的话，哪怕错了也不知道 这不就跟我们写代码的初衷发生了偏离

其次是要拿我们上面的需求去找切入点 一般复杂的项目都不是类似脚本的顺序执行逻辑 很多功能都是在图状的结构拥有不同的切面 那我们没很难通过顺序阅读幂函数来理解项目 那我们就得 通过一些直觉来 分析项目跟我们功能相关的那些逻辑 
对于一个后端项目来说 我们通常要修改的都是一个a p i 那一种很朴素的办法就是。从路由层切入。 看一看是哪个controller，实现了对应的 api。 比如 实在没有思路的话，我们甚至 可以在仓库中直接字符串搜索  在仓库项目中搜索对应的 a p i名称看一看，有没有一些字符串对应这个 a p i 然后 以此为切入点去找到项目。 
那对于前端的话 嗯，我们不妨直接f12打开控制台查看我们想要修改的元素。 对应的类名sn 以此为基础找到我们具体对应的u i是哪些功能 sn当然，那显然 如果我们能找到一个社区的pr 就能省去这部定位的流程，这也是为什么我之前反复提及我们要follow一个 pro request的重要性 pull request 

再把项目运行起来以后 我们可以做一些 实验性质的修改 来。 验证，我们的 对于项目的理解是否正确 这一步其实不太需要追求 我们真正。 能不能改到符合我们预期的效果。我们只需要培 出一种 对项目运行逻辑的直觉，因为sn客观上一个巨大的项目。我们是没法儿 11行一行的 sn理解项目逻辑的那通过这种 sn类似黑河调试的方法 让我们对项目的功能大概如何 执行有个？ 估计也是一种很好的入手手段sn。  当然，如果能嗯打上断点查看调用站。 我们就会能对功能的 执行sn逻辑有一个 sn，比较全流程的认识 那在有了这个信息之后，我们就可以沿着调用站去分析整个项目的逻辑真正开始 切实的理解源码逻辑这一步****作了 

嗯在此之后的sn策略 一方面。 他确实基于每个项目强相关 很难有一个通用的方式去给人思路 ，这部分流程确实还是比较依赖经验 ，另一方面也有很多大佬无论是在b站知乎或者其他地方有了对这些 手段的介绍 ，那秉持着程序员不要重复造轮子的思想 我就不具体介绍，这一部分流程呃可能需要大家。 自己也多多总结另外，也可以学习一些 嗯其他 大佬们的 建议 

以上就是我个人 sn阅读源码的整套思路。 希望能对大家有所帮助 

## 实践 -- 简单修改 VSCode 代码

那先拿一个真实的例子来说，就是修改v s code代码那首先 我们要想的是我们有什么确切的需求需要解决sn拿我自己来说 ，我会经常在。 s code里边记笔记。 但是中文笔记有一个巨大的痛点是 当我使用 alt加左右键跳转时，它会如这样所示一下跳转一整个句子而并不是像英文一样跳转若干单词 sn。 那这就对我的 文章修改过程造成了非常大的不便 基本上是不可用的状态 那我 第一的想法，就是去看 
我是一个高频使用 VSCode 记录 Markdown 笔记的人. 进行中文写作时, 我最大的痛点是: VSCode 单词跳转功能的使用体验不佳 (快捷键 Alt + ArrowLeft 及 Alt + ArrowRight 对应的 cursorWordLeft 与 cursorWordRight 命令). 受限于 VSCode 基于空格的分词策略, 中文的一整段话被视为了一个单词. 更糟糕的是, 由于汉字标点符号并非 ascii 字符, 所以跳转甚至都不是基于一句而是一整段话. 按一下上述快捷键, 一整段话就会跳过去, 每每碰到这一点都让人感到恼火.

所以之前我采用的是 这个插件 来实现分词跳转的能力, 可以说其功能还是相对全面的. 唯二的缺憾是, 受 VSCode 的插件 API 限制, 插件并不能实现鼠标双击仅选择当前 Token 的能力. 另外, 插件毕竟还是对整个应用性能有一丁点的拖累, 心中稍有一丝不爽.

但今天早上起床之后, 我突然灵光一闪: 这个插件下载量只有一万多次, 但使用 VSCode 写 Markdown 的中日文用户一定不只是这一点, 那么多中国人、日本人或者其他有类似语言的国家的人, 一定都非常苦恼于这个场景的糟糕体验, 那为什么不去搜搜 VSCode 官方是否有成熟的解决方案呢? 一看还真有, Issue 50045 就完美地描述了这个需求, 但毕竟 VSCode 的核心开发者都是欧美国家的人, 对他们而言恐怕都想象不到这到底是一个什么样子的 case. 为了完成一个需求要再学一门架构与先前掌握语言比完全不同的自然语言, 实在是有些夸张了.

好在我又注意到这个 Issue 已经被关闭了. 既然 Issue 是长期存在的需求, 而并非偶现的 Bug, 那这大概率是说明有人已经完成了这个功能的开发. 再往下翻一番, 果然如此: 一位日本友人发起的 PR 203605 关闭了该需求. 又发现这个 PR 是今年年初才发起, 这也解释了为什么我之前只搜到了上述插件, 而并非是这个原生功能.

从需求提出 (2018-05) 到需求解决 (2024-01), 中间经历了快六年的时间, 让人不禁感慨: i18n 实在是太难了!

但这其实未必结束 ，因为这些社区贡献的代码受限于提交者自己的理解限制，他们未必能完美的把这个需求做完在其中还是有一些可以小修小补的地方，这就是我们继续为项目进行贡献的机会和入手的一些点 就拿这个项目为例 作者只实现了在editor里面的 中文条或者说，文字跳转 但比如我们在 一些特殊的simple editor里比如 chat view或者是。 s m auditor，这些领域 并没有同样的实现跳转的效果 这说明 其功能还是漏了一些东西 ，那我们就恰好可以以此为入手来分析为什么它丢了一些内容 那当然，我们最好还是把项目启动起来看一下这些内容中为什么没有生效 嗯首先一个思路是review他的 m r 因为这段代码肯定是核心业务逻辑，我们可以先在项目中找到这些内容来分析到底它出现。 哪些问题导致还不可用 

参考链接
https://sharzy.in/posts/2020-02-04-cjk-helper/
https://github.com/microsoft/vscode/pull/203605
https://github.com/microsoft/vs